"use strict";var customSearch,apFixed,scrollCorrection=70,scrollToElement=function(e,t){t=t||scrollCorrection;e=e.href?$(e.getAttribute("href")):$(e);$("html, body").animate({scrollTop:e.offset().top-t},500)},initCustomSearch=function(){"google"===CONFIG.search_service?customSearch=new GoogleCustomSearch({apiKey:GOOGLE_CUSTOM_SEARCH_API_KEY,engineId:GOOGLE_CUSTOM_SEARCH_ENGINE_ID,imagePath:"/images/"}):"algolia"===CONFIG.search_service?customSearch=new AlgoliaSearch({apiKey:ALGOLIA_API_KEY,appId:ALGOLIA_APP_ID,indexName:ALGOLIA_INDEX_NAME,imagePath:"/images/"}):"hexo"===CONFIG.search_service?customSearch=new HexoSearch({imagePath:"/images/"}):"azure"===CONFIG.search_service?customSearch=new AzureSearch({serviceName:AZURE_SERVICE_NAME,indexName:AZURE_INDEX_NAME,queryKey:AZURE_QUERY_KEY,imagePath:"/images/"}):"baidu"===CONFIG.search_service&&(customSearch=new BaiduSearch({apiId:BAIDU_API_ID,imagePath:"/images/"}))},initHeaderMenu=function(){var a=$("header .menu"),n=a.find(".underline");function t(e,t){e=e||a.find("li a.active"),(t=void 0===t||!!t)||n.addClass("disable-trans"),e&&e.length?(e.addClass("active").siblings().removeClass("active"),n.css({left:e.position().left,width:e.innerWidth()})):n.css({left:0,width:0}),t||setTimeout(function(){n.removeClass("disable-trans")},0)}a.on("mouseenter","li",function(e){t($(e.currentTarget))}),a.on("mouseout",function(){t()});var e,i=null;"/"===location.pathname||location.pathname.startsWith("/page/")?i=$(".nav-home",a):1<(e=(e="/"===(e=location.pathname)[e.length-1]?e:e+"/").match(/\/(.*?)\//)).length&&(i=$(".nav-"+e[1],a)),t(i,!1)},initHeaderMenuPhone=function(){var t=$(".l_header .switcher .s-menu");t.click(function(e){e.stopPropagation(),$("body").toggleClass("z_menu-open"),t.toggleClass("active")}),$(document).click(function(e){$("body").removeClass("z_menu-open"),t.removeClass("active")})},initHeaderSearch=function(){var e=$(".l_header .switcher .s-search"),t=$(".l_header"),a=$(".l_header .m_search");0!==e.length&&(e.click(function(e){e.stopPropagation(),t.toggleClass("z_search-open"),a.find("input").focus()}),$(document).click(function(e){t.removeClass("z_search-open")}),a.click(function(e){e.stopPropagation()}))},initHeaderIconTop=function(){var e=$("header .wrapper");$(".s-top",e).click(function(){return scrollToElement(document.body)})},initHeaderIconDown=function(){var e=$("header .wrapper"),e=$(".s-down",e),t=$("#footer");e.click(function(e){e.preventDefault(),e.stopPropagation(),scrollToElement(t)})},initHeaderIconComment=function(){var e=$("header .wrapper"),t=$(".s-comment",e),e=$(".s-down",e),a=$(".comment");a.length?(e.hide(),t.unbind("click"),t.show(),t.click(function(e){e.preventDefault(),e.stopPropagation(),scrollToElement(a)})):(t.hide(),e.show())},initHeader=function(){var a,n,e=$("header .menu").find("li a.active");e&&e.length&&e.removeClass("active"),window.subData&&((a=$("header .wrapper")).find(".nav-sub .logo").text(window.subData.title),n=document.body.scrollTop,$(document,window).scroll(function(){var e=$(window).scrollTop(),t=e-n;50<=t&&100<e?(n=e,a.addClass("sub")):t<=-50&&(n=e,a.removeClass("sub"))}))},initWaves=function(){Waves.attach(".flat-btn",["waves-button"]),Waves.attach(".float-btn",["waves-button","waves-float"]),Waves.attach(".float-btn-light",["waves-button","waves-float","waves-light"]),Waves.attach(".flat-box",["waves-block"]),Waves.attach(".float-box",["waves-block","waves-float"]),Waves.attach(".waves-image"),Waves.init()},initReveal=function(){var e;0!==$(".reveal").length&&((e=ScrollReveal({distance:"0px",easing:"ease-in"})).destroy(),e.reveal(".reveal"))},initToc=function(){$(".toc-wrapper").length&&($(".toc-wrapper a").unbind("click"),$(".toc-wrapper a").on("click",function(e){e.preventDefault(),e.stopPropagation(),scrollToElement(this)}))},initEssay=function(){$("#digest, #open").fadeOut(1e3,function(){$("#content").fadeIn(1e3)})},initSince=function e(){window.setTimeout(function(){e()},1e3);var t=new Date(CONFIG.since),t=((new Date).getTime()-t.getTime())/864e5,a=Math.floor(t),t=24*(t-a),n=Math.floor(t),i=60*(t-n),t=Math.floor(60*(t-n)),i=Math.floor(60*(i-t));$("#since").html(a+"天"+n+"时"+t+"分"+i+"秒")},initEvanyou=function(){if(document.getElementById("evanyou")){var a,e=function(e,t){i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y);e=t.x+(2*m()-.25)*l,t=n(t.y);i.lineTo(e,t),i.closePath(),u-=d/-50,i.fillStyle="#"+(127*h(u)+128<<16|127*h(u+d/3)+128<<8|127*h(u+d/3*2)+128).toString(16),i.fill(),a[0]=a[1],a[1]={x:e,y:t}},n=function e(t){var a=t+(2*m()-1.1)*l;return c<a||a<0?e(t):a},t=document.getElementById("evanyou"),i=t.getContext("2d"),o=window.devicePixelRatio||1,r=window.innerWidth,c=window.innerHeight,l=90,s=Math,u=0,d=2*s.PI,h=s.cos,m=s.random;for(t.width=r*o,t.height=c*o,i.scale(o,o),i.globalAlpha=.6,i.clearRect(0,0,r,c),a=[{x:0,y:.7*c+l},{x:0,y:.7*c-l}];a[1].x<r+l;)e(a[0],a[1])}},initAplayer=function(){document.getElementById("aplayer-fixed")&&((apFixed=new APlayer({element:document.getElementById("aplayer-fixed"),mutex:!0,order:"list",lrcType:3,fixed:!0})).lrc.hide(),$.ajax({url:"https://api.i-meto.com/meting/api?server=netease&type=playlist&id=2663347612",success:function(e){apFixed.list.add(JSON.parse(JSON.stringify(e)))}}))},initCount=function(e){var e=[((e=e).match(/[\u4E00-\u9FA5]/g)||[]).length,(e.replace(/[\u4E00-\u9FA5]/g,"").match(/[a-zA-Z0-9_\u0392-\u03c9\u0400-\u04FF]+|[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af\u0400-\u04FF]+|[\u00E4\u00C4\u00E5\u00C5\u00F6\u00D6]+|\w+/g)||[]).length],t=e[0]+e[1],t=t<1e3?t:Math.round(t/100)/10+"k",e=e[0]/300+e[1]/160,e=e<1?"1":parseInt(e,10);$("#wordcount").text(t),$("#min2read").text(e)},lazyImage=function(){$("img").not(".avatar").each(function(){var e=$(this),t=e.attr("src");e.attr("data-original")||(e.attr("class")&&!e.hasClass("lazy")?e.attr("class",e.attr("class")+" lazy"):e.attr("class","lazy"),e.attr("data-original",t),e.removeAttr("src"))})},wrapImage=function(){$("img").not(".avatar").not(".thumb").each(function(){var e=$(this);if(!e.attr("data-src")){var t=e.attr("alt"),a=e.parent("a");if(a.length<1){var n=e.attr("data-original");if(null==n)return;var i=n.lastIndexOf("?");-1!==i&&(n=n.substring(0,i)),a=e.wrap('<a href="'+n+'"></a>').parent("a")}a.attr("data-fancybox","gallery"),t&&a.attr("data-caption",t)}})},loadImage=function(){$("img.lazy").lazyload({effect:"fadeIn",threshold:50})},initImage=function(){location.pathname.startsWith("/blog/gallery/")||(lazyImage(),wrapImage(),loadImage())},initGallery=function(){var a,i,n;location.pathname.startsWith("/blog/gallery/")&&(a=[],i=document.getElementById("gallery"),n=function(e){var t=document.createElement("img"),a=(t.setAttribute("src",e.url),document.createElement("div")),n="flex-grow:"+100*e.width/e.height+";flex-basis:"+200*e.width/e.height+"px;",n=(a.setAttribute("style",n),document.createElement("i")),e="padding-bottom:"+e.height/e.width*100+"%";n.setAttribute("style",e),a.appendChild(n),a.appendChild(t),i.appendChild(a)},fetch("/blog/gallery/data.json").then(function(e){return e.json()}).then(function(e){a=e.pics;for(var t=i;t.firstChild;)t.removeChild(t.firstChild);a.forEach(n),document.body.scrollTop=0,lazyImage(),wrapImage(),loadImage()}))},init=function(){initCustomSearch(),initHeader(),initHeaderIconTop(),initHeaderIconDown(),initHeaderIconComment(),initHeaderMenu(),initHeaderMenuPhone(),initHeaderSearch(),initWaves(),initReveal(),initToc(),initGallery(),initImage(),initSince(),initAplayer(),initEvanyou()},pjax_init=function(){initHeader(),initHeaderIconComment(),initHeaderMenu(),initWaves(),initReveal(),initToc(),initGallery(),initImage(),initEvanyou()};